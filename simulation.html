<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Running a Simulation - Keramik</title>
                

        <!-- Custom HTML head -->
        

        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

                <link rel="icon" href="favicon.svg">
                        <link rel="shortcut icon" href="favicon.png">
                <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
                <link rel="stylesheet" href="css/print.css" media="print">
        
        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
                <link rel="stylesheet" href="fonts/fonts.css">
        
        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="highlight.css">
        <link rel="stylesheet" href="tomorrow-night.css">
        <link rel="stylesheet" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        
            </head>
    <body>
        <!-- Provide site root to javascript -->
        <script type="text/javascript">
            var path_to_root = "";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded "><a href="environment.html"><strong aria-hidden="true">1.</strong> Environment Setup</a></li><li class="chapter-item expanded "><a href="create_cluster.html"><strong aria-hidden="true">2.</strong> Creating a Cluster</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="deploy_keramik.html"><strong aria-hidden="true">2.1.</strong> Deploying Keramik</a></li><li class="chapter-item expanded "><a href="setup_network.html"><strong aria-hidden="true">2.2.</strong> Setup Network</a></li></ol></li><li class="chapter-item expanded "><a href="simulation.html" class="active"><strong aria-hidden="true">3.</strong> Running a Simulation</a></li><li class="chapter-item expanded "><a href="analysis.html"><strong aria-hidden="true">4.</strong> Analyzing Simulation Runs</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="datadog.html"><strong aria-hidden="true">4.1.</strong> Analysis with Datadog</a></li></ol></li><li class="chapter-item expanded "><a href="developing.html"><strong aria-hidden="true">5.</strong> Developing Keramik</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="developing_operator.html"><strong aria-hidden="true">5.1.</strong> Operator</a></li><li class="chapter-item expanded "><a href="developing_runner.html"><strong aria-hidden="true">5.2.</strong> Runner</a></li></ol></li><li class="chapter-item expanded "><a href="advanced.html"><strong aria-hidden="true">6.</strong> Advanced Topics</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="advanced_configuration.html"><strong aria-hidden="true">6.1.</strong> Advanced CAS and Ceramic Configuration</a></li><li class="chapter-item expanded "><a href="monitoring.html"><strong aria-hidden="true">6.2.</strong> Monitoring</a></li><li class="chapter-item expanded "><a href="ipfs.html"><strong aria-hidden="true">6.3.</strong> IPFS</a></li><li class="chapter-item expanded "><a href="mixed_networks.html"><strong aria-hidden="true">6.4.</strong> Mixed Networks</a></li><li class="chapter-item expanded "><a href="secrets.html"><strong aria-hidden="true">6.5.</strong> Secrets</a></li><li class="chapter-item expanded "><a href="operator.html"><strong aria-hidden="true">6.6.</strong> Operator Design</a></li><li class="chapter-item expanded "><a href="migration.html"><strong aria-hidden="true">6.7.</strong> Migration Tests</a></li><li class="chapter-item expanded "><a href="advanced_bootstrap.html"><strong aria-hidden="true">6.8.</strong> Custom Bootstrap Configuration</a></li></ol></li></ol>            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light (default)</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                                                <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                                            </div>

                    <h1 class="menu-title">Keramik</h1>

                    <div class="right-buttons">
                                                <a href="print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                                                                        
                    </div>
                </div>

                                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>
                
                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="simulation"><a class="header" href="#simulation">Simulation</a></h1>
<p>To run a simulation, first define a simulation. Available simulation types are</p>
<ul>
<li><code>ipfs-rpc</code> - A simple simulation that writes and reads to IPFS</li>
<li><code>ceramic-simple</code> - A simple simulation that writes and reads events to two different streams, a small and large model</li>
<li><code>ceramic-write-only</code> - A simulation that only performs updates on two different streams</li>
<li><code>ceramic-new-streams</code> - A simulation that only creates new streams</li>
<li><code>ceramic-model-reuse</code> - A simulation that reuses the same model and queries instances across workers</li>
<li><code>recon-event-sync</code> - A simulation that creates events for Recon to sync at a fixed rate (~300/s by default). Designed for a 2 node network but should work on any.</li>
<li><code>cas-benchmark</code> - A simulation that benchmarks the CAS network. </li>
<li><code>cas-anchoring-benchmark</code> - A simulation that benchmarks the Ceramic with anchoring enabled.</li>
</ul>
<p>Using one of these scenarios, we can then define the configuration for that scenario:</p>
<pre><code class="language-yaml"># basic.yaml
---
apiVersion: &quot;keramik.3box.io/v1alpha1&quot;
kind: Simulation
metadata:
  name: basic
  # Must be the same namespace as the network to test
  namespace: keramik-&lt;unique-name&gt;-small
spec:
  scenario: ceramic-simple
  devMode: true # optional to remove container resource limits and requirements for local benchmarking
  users: 10
  runTime: 4
</code></pre>
<p>If you want to run it against a defined network, set the namespace to the same as the network. in this example the
namespace is set to the same network applied when <a href="./setup_network.html">the network was setup</a>.
Additionally, you can define the scenario you want to run, the number of users to run for each node, and the number of minutes it will run.</p>
<p>Before running the simulation make sure the <code>network</code> is ready and has <a href="./monitoring.html">monitoring</a> enabled.</p>
<pre><code>kubectl describe network &lt;unique-name&gt;-small
</code></pre>
<p>You should see that the number of <code>Ready Replicas</code> is the same as the <code>Replicas</code>.
Example simplified output of a ready network:</p>
<pre><code class="language-txt">Name:         nc-small
...
  Ready Replicas:  2
  Replicas:        2
...
</code></pre>
<p>Once ready, apply this simulation defintion to the k8s cluster:</p>
<pre><code class="language-shell">kubectl apply -f basic.yaml
</code></pre>
<p>Keramik will first start all the metrics and tracing resources, once ready it will start the simulation by first starting the simulation manager and then all the workers.
The manager and workers will stop once the simulation is complete.</p>
<p>You can then <a href="analysis.html">analyze</a> the results of the simulation.</p>
<p>If you want to rerun a simulation with no changes, you can delete the simulation and reapply it.</p>
<pre><code class="language-shell">kubectl delete -f basic.yaml
</code></pre>
<h2 id="simulating-specific-versions"><a class="header" href="#simulating-specific-versions">Simulating Specific Versions</a></h2>
<p>Often you will want to run a simulation against a specific version of software.
To do this you will need to build the image and configure your network to run that image.</p>
<h3 id="example-custom-js-ceramic-image"><a class="header" href="#example-custom-js-ceramic-image">Example Custom JS-Ceramic Image</a></h3>
<p>Use this example <code>network</code> definition with a custom <code>js-ceramic</code> image.</p>
<pre><code class="language-yaml"># custom-js-ceramic.yaml
---
apiVersion: &quot;keramik.3box.io/v1alpha1&quot;
kind: Network
metadata:
  name: custom-js-ceramic
spec:
  replicas: 2
  monitoring:
    namespaced: true
  ceramic:
    - image: ceramicnetwork/composedb:dev
      imagePullPolicy: IfNotPresent
</code></pre>
<pre><code class="language-shell">kubectl apply -f custom-js-ceramic.yaml
</code></pre>
<p>You can also run <a href="./mixed_networks.html">mixed networks</a> and various other <a href="./advanced_configuration.html">advanced</a> configurations.</p>
<h3 id="example-custom-ipfs-image"><a class="header" href="#example-custom-ipfs-image">Example Custom IPFS Image</a></h3>
<p>Use this example <code>network</code> definition with a custom <code>IPFS</code> image.</p>
<pre><code class="language-yaml"># custom-ipfs.yaml
---
apiVersion: &quot;keramik.3box.io/v1alpha1&quot;
kind: Network
metadata:
  name: custom-ipfs
spec:
  replicas: 2
  monitoring:
    namespaced: true
  ceramic:
    - ipfs:
        rust:
          image: ceramicnetwork/rust-ceramic:dev
          imagePullPolicy: IfNotPresent
</code></pre>
<pre><code class="language-shell">kubectl apply -f custom-ipfs.yaml
</code></pre>
<h3 id="example-custom-cas-api-url-network-spec"><a class="header" href="#example-custom-cas-api-url-network-spec">Example Custom CAS Api Url Network Spec</a></h3>
<p>Use this example in the network definition while using <code>cas-benchmark</code> or <code>cas-anchoring-benchmark</code>. This is specifically for testing against the CAS dev network.</p>
<pre><code class="language-yaml"># custom-cas-api.yaml
---
apiVersion: keramik.3box.io/v1alpha1
kind: Network
metadata:
  name: ceramic-benchmark
spec:
  ceramic:
    - env:
        CERAMIC_RECON_MODE: &quot;true&quot;
      ipfs:
        rust:
          env:
            CERAMIC_ONE_RECON: &quot;true&quot;
  casApiUrl: https://cas-dev-direct.3boxlabs.com
  networkType: dev-unstable
  privateKeySecret: ceramic-v4-dev
  ethRpcUrl: &quot;&quot;
</code></pre>
<pre><code class="language-shell">kubectl apply -f custom-cas-api.yaml
</code></pre>
<h3 id="example-custom-simulation-for-ceramic-anchoring-benchmark"><a class="header" href="#example-custom-simulation-for-ceramic-anchoring-benchmark">Example Custom Simulation for Ceramic Anchoring Benchmark</a></h3>
<p>Use this example to run a simulation which uses the CAS Api defined in the network spec. 
<code>anchorWaitTime</code>: Wait time in seconds for how long we want to wait after streams have been created to check when they have been anchored. This should be a high number like 30-40 minutes.
<code>throttleRequests</code>: Number of requests to send per second.</p>
<pre><code class="language-yaml"># ceramic-anchoring-benchamrk.yaml
---
apiVersion: &quot;keramik.3box.io/v1alpha1&quot;
kind: Simulation
metadata:
  name: basic
  # Must be the same namespace as the network to test
  namespace: keramik-ceramic-benchmark
spec:
  scenario: ceramic-anchoring-benchmark
  users: 16
  runTime: 60
  throttleRequests: 100
  anchorWaitTime: 2400
</code></pre>
<pre><code class="language-shell">kubectl apply -f ceramic-anchoring-benchamrk.yaml
</code></pre>
<h3 id="example-custom-simulation-for-cas-benchmark"><a class="header" href="#example-custom-simulation-for-cas-benchmark">Example Custom Simulation for cas-benchmark</a></h3>
<p>Use this example to run a simulation you can pass in the the cas-api-url, the network-type, and the private secret key in the spec.
By default the casNetwork and casController are set to run against cas-dev-direct Api.</p>
<p><code>casNetwork</code>: The url of the CAS network to run the simulation against.</p>
<p><code>casController</code>: The private key of the controller DID to use for the simulation.</p>
<pre><code class="language-yaml"># cas-benchmark.yaml
---
apiVersion: &quot;keramik.3box.io/v1alpha1&quot;
kind: Simulation
metadata:
  name: basic
  # Must be the same namespace as the network to test
  namespace: keramik-ceramic-benchmark
spec:
  scenario: ceramic-anchoring-benchmark
  users: 16
  runTime: 60
  throttleRequests: 100
  casNetwork: &quot;https://cas-dev-direct.3boxlabs.com&quot;
  casController: &quot;did:key:&lt;secret&gt;&quot;
</code></pre>
<pre><code class="language-shell">kubectl apply -f cas-benchmark.yaml
</code></pre>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                                                    <a rel="prev" href="setup_network.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>
                        
                                                    <a rel="next" href="analysis.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>
                        
                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                                    <a rel="prev" href="setup_network.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>
                
                                    <a rel="next" href="analysis.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
                            </nav>

        </div>

        
        
        
                <script type="text/javascript">
            window.playground_copyable = true;
        </script>
        
        
                <script src="elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="searcher.js" type="text/javascript" charset="utf-8"></script>
        
        <script src="clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="book.js" type="text/javascript" charset="utf-8"></script>

        <!-- Custom JS scripts -->
        
        
    </body>
</html>
